name: DIANA:DIAG - Connection diagnostics

on:
  workflow_dispatch:
  push:
    branches: [master]

jobs:
  diagnose:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ” Ping server
      run: |
        if command -v ping; then ping -c 4 ${{ secrets.PROD_HOST }}; else echo "âŒ ping not available"; fi

    - name: ğŸ§ª Check port 22 (SSH)
      run: |
        if command -v nc; then nc -vz -w5 ${{ secrets.PROD_HOST }} 22 || echo "âŒ Port 22 is unreachable"; else echo "âŒ nc not available"; fi

    - name: ğŸŒ Curl HTTP (port 80)
      run: curl -I --max-time 5 http://${{ secrets.PROD_HOST }} || echo "âŒ Port 80 not responding"

    - name: ğŸ”’ Curl HTTPS (port 443)
      run: curl -I --max-time 5 https://${{ secrets.PROD_HOST }} || echo "âŒ Port 443 not responding"

    - name: ğŸ›°ï¸ Optional: Traceroute
      run: |
        if command -v traceroute; then
          traceroute ${{ secrets.PROD_HOST }}
        else
          echo "âš ï¸ traceroute not installed"
        fi

    - name: âœ… Diagnostic completed
      run: echo "DIANA:DIAG completed. Check above for any âŒ indicators."
